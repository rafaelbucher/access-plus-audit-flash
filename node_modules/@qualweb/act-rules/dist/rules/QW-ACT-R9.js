"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.QW_ACT_R9 = void 0;
const applicability_1 = require("@qualweb/util/applicability");
const evaluation_1 = require("@qualweb/core/evaluation");
const AtomicRule_object_1 = require("../lib/AtomicRule.object");
class QW_ACT_R9 extends AtomicRule_object_1.AtomicRule {
    execute() {
        const links = window.qwPage.getElements('a[href], [role="link"]');
        const accessibleNames = new Array();
        const hrefList = new Array();
        const applicableLinks = new Array();
        for (const link of links !== null && links !== void 0 ? links : []) {
            let aName;
            if (window.DomUtils.isElementADescendantOf(link, ['svg'], [])) {
                aName = window.AccessibilityUtils.getAccessibleNameSVG(link);
            }
            else if (window.AccessibilityUtils.isElementInAT(link)) {
                aName = window.AccessibilityUtils.getAccessibleName(link);
            }
            const href = link.getElementAttribute('href');
            if (aName) {
                hrefList.push(href);
                accessibleNames.push(aName);
                applicableLinks.push(link);
            }
        }
        let counter = 0;
        const blacklist = new Array();
        for (const accessibleName of accessibleNames !== null && accessibleNames !== void 0 ? accessibleNames : []) {
            const elementList = new Array();
            if (blacklist.indexOf(counter) < 0 && accessibleName && accessibleName !== '') {
                const hasEqualAn = this.isInListExceptIndex(accessibleName, accessibleNames, counter);
                if (hasEqualAn.length > 0) {
                    blacklist.push(...hasEqualAn);
                    let hasEqualHref = true;
                    for (const index of hasEqualAn) {
                        hasEqualHref = hrefList[index] === hrefList[counter] && hrefList[counter] !== null;
                        elementList.push(applicableLinks[index]);
                    }
                    elementList.push(applicableLinks[counter]);
                    hasEqualAn.push(counter);
                    const test = new evaluation_1.Test();
                    if (hasEqualHref) {
                        test.verdict = evaluation_1.Verdict.PASSED;
                        test.resultCode = 'P1';
                    }
                    else {
                        test.verdict = evaluation_1.Verdict.WARNING;
                        test.resultCode = 'F1';
                    }
                    test.addElements(elementList, true, false, true);
                    this.addTestResult(test);
                }
            }
            counter++;
        }
    }
    isInListExceptIndex(accessibleName, accessibleNames, index) {
        const result = new Array();
        let counter = 0;
        for (const accessibleNameToCompare of accessibleNames !== null && accessibleNames !== void 0 ? accessibleNames : []) {
            if (accessibleNameToCompare === accessibleName && counter !== index) {
                result.push(counter);
            }
            counter++;
        }
        return result;
    }
}
exports.QW_ACT_R9 = QW_ACT_R9;
__decorate([
    applicability_1.ElementExists,
    applicability_1.IsInMainContext,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], QW_ACT_R9.prototype, "execute", null);
