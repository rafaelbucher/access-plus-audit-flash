"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.QW_ACT_R44 = void 0;
const applicability_1 = require("@qualweb/util/applicability");
const evaluation_1 = require("@qualweb/core/evaluation");
const AtomicRule_object_1 = require("../lib/AtomicRule.object");
class QW_ACT_R44 extends AtomicRule_object_1.AtomicRule {
    execute(element) {
        const links = element.getElements('a[href], [role="link"]');
        const linkDataList = new Array();
        for (const link of links || []) {
            let aName;
            if (window.DomUtils.isElementADescendantOf(link, ['svg'], [])) {
                aName = window.AccessibilityUtils.getAccessibleNameSVG(link);
            }
            else if (window.AccessibilityUtils.isElementInAT(link)) {
                aName = window.AccessibilityUtils.getAccessibleName(link);
            }
            const href = link.getElementAttribute('href');
            const context = window.AccessibilityUtils.getLinkContext(link);
            if (aName) {
                linkDataList.push({
                    context,
                    href,
                    aName,
                    link
                });
            }
        }
        let counter = 0;
        const blacklist = new Array();
        for (const linkData of linkDataList || []) {
            const test = new evaluation_1.Test();
            const elementList = new Array();
            if (blacklist.indexOf(counter) >= 0) {
            }
            else if (!!linkData.aName && linkData.aName !== '') {
                const hasEqualAn = this.isInListExceptIndex(linkData, linkDataList, counter);
                if (hasEqualAn.length > 0) {
                    blacklist.push(...hasEqualAn);
                    let hasEqualHref = false;
                    for (const index of hasEqualAn) {
                        hasEqualHref =
                            linkDataList[index].href === linkDataList[counter].href && linkDataList[counter].href !== null;
                        elementList.push(linkDataList[index].link);
                    }
                    elementList.push(linkDataList[counter].link);
                    if (hasEqualHref) {
                        test.verdict = evaluation_1.Verdict.PASSED;
                        test.resultCode = 'P1';
                    }
                    else {
                        test.verdict = evaluation_1.Verdict.WARNING;
                        test.resultCode = 'W1';
                    }
                    test.addElements(elementList);
                    this.addTestResult(test);
                }
            }
            counter++;
        }
    }
    isInListExceptIndex(linkData, linkDataList, index) {
        const result = new Array();
        let counter = 0;
        for (const linkDataToCompare of linkDataList || []) {
            if (linkDataToCompare.aName === linkData.aName &&
                linkData.context.toString() === linkDataToCompare.context.toString() &&
                counter !== index) {
                result.push(counter);
            }
            counter++;
        }
        return result;
    }
}
exports.QW_ACT_R44 = QW_ACT_R44;
__decorate([
    applicability_1.ElementExists,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Function]),
    __metadata("design:returntype", void 0)
], QW_ACT_R44.prototype, "execute", null);
